name: Dependabot Security Updates

on:
  schedule:
    # Check for updates at 2am UTC daily
    - cron: '0 2 * * *'
  workflow_dispatch:

jobs:
  security-updates:
    name: Review Security Updates
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.21'
        
    - name: Check for security vulnerabilities
      run: |
        go install golang.org/x/vuln/cmd/govulncheck@latest
        govulncheck ./...
        
    - name: Check dependency freshness
      run: |
        go list -u -m all
        
    - name: Comment on issues with security labels
      uses: actions/github-script@v6
      with:
        script: |
          const issues = await github.rest.issues.listForRepo({
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: 'security',
            state: 'open'
          });
          
          for (const issue of issues.data) {
            console.log(`Found security issue: ${issue.title}`);
          }
